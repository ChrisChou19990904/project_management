<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>外語學習實體書販賣網站：專案核心說明</title>
  <style>
    body { font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; margin: 20px; color: #333; }
    h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
    h2 { color: #333; margin-top: 30px; border-left: 5px solid #ffc107; padding-left: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
    th { background-color: #f2f2f2; color: #333; }
    .highlight { font-weight: bold; color: #d9534f; }
    .citation { font-size: 0.9em; color: #888; margin-top: 5px;}
    a{text-decoration:none;}
    a:hover {text-decoration:underline;}
    a:visited { color: blue; }
  </style>
</head>
<body>

<h1>外語學習實體書販賣網站：專案核心說明</h1>
<p>
  <strong>專案名稱：</strong>外語學習實體書販賣網站<br>
  <strong>開發者：</strong>周彥廷 D1397102<br>
  <strong>核心技術棧：</strong>Vue 3 + Spring Boot + Supabase
</p>

<hr>
<h2>目錄</h2>
<p>隨便點入下方一個主題便能快速跳到該主題的說明區</p>
<ol>
  <li><a href="#section1">開發框架與技術棧 (Development Stack)</a></li>
  <li><a href="#section2">詳細資料庫設計結構 (Supabase PostgreSQL)</a></li>
  <li><a href="#section3">前台功能 (Frontend Features)</a></li>
  <li><a href="#section4">後台管理功能 (Backend Admin Features)</a></li>
  <li><a href="#section5">帳號與權限架構（Role-Based Access Control, RBAC）</a></li>
  <li><a href="#section6">JWT 身分驗證流程（後端驗證方式）</a></li>
  <li><a href="#section7">管理員帳號的建立方式</a></li>
  <li><a href="#section8">Figma 設計：註冊與登入頁（Wireframe）</a></li>
  <li><a href="#section9">Figma AI 原型與資料同步說明</a></li>
  <li><a href="#section10">Figma 原型示範影片說明</a></li>
  <li><a href="#section11">Spring Boot：註冊與登入 API 程式碼</a></li>
  <li><a href="#section12">Vue 前端：登入後依角色導向</a></li>
  <li><a href="#section13">Spring Security：後台 API 權限驗證</a></li>
  <li><a href="#section14">本專案的權限安全結論</a></li>
</ol>
<h2 id="section1">一、 開發框架與技術棧 (Development Stack)</h2>
<p>技術棧選用被定位為「單人開發最強組合」。</p>

<table>
  <thead>
  <tr>
    <th>技術組成</th>
    <th>核心優勢與功能</th>
    <th>架構定位與資料流</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td><strong>前端 (Vue 3 + Vite)</strong></td>
    <td>組件化、開發快速 。使用 Pinia 進行狀態管理。</td>
    <td>瀏覽器 (RWD) 端，透過 Axios 發送請求。預計部署至 GitHub Pages。</td>
  </tr>
  <tr>
    <td><strong>後端 (Spring Boot 3)</strong></td>
    <td>企業級後端、內建 Security + JPA。</td>
    <td>處理 REST Controllers；包含 JWT Filter 進行安全驗證。資料經 Spring Data JPA 存取資料庫。預計部署至 GitHub Pages。</td>
  </tr>
  <tr>
    <td><strong>資料庫/服務 (Supabase PostgreSQL)</strong></td>
    <td>免伺服器 PostgreSQL，免費 500MB 足夠專案使用。內建 Auth 身份驗證。</td>
    <td>提供底層資料儲存；處理用戶登入(使用者 → 登入 → Supabase Auth → JWT)。</td>
  </tr>
  </tbody>
</table>

<hr>
<h2 id="section2">二、 詳細資料庫設計結構 (Supabase PostgreSQL)</h2>
<p>所有表格的資料型態為建議值，以確保功能完整性。</p>

<table>
  <thead>
  <tr>
    <th>表格名稱 (Table Name)</th>
    <th>欄位名稱 (Column)</th>
    <th>資料型別 (Data Type)</th>
    <th>備註 (Description)</th>
  </tr>
  </thead>
  <tbody>

  <!-- USERS -->
  <tr>
    <td rowspan="7"><strong>users</strong> (會員)</td>
    <td>user_id</td>
    <td>SERIAL (PK)</td>
    <td>主鍵，自動遞增。</td>
  </tr>
  <tr>
    <td>username</td>
    <td>VARCHAR(50)</td>
    <td>會員帳號/暱稱，UNIQUE。</td>
  </tr>
  <tr>
    <td>email</td>
    <td>VARCHAR(100)</td>
    <td>會員信箱，UNIQUE。</td>
  </tr>
  <tr>
    <td>password_hash</td>
    <td>TEXT</td>
    <td>Spring Security 加密後的密碼 (Bcrypt)。</td>
  </tr>
  <tr>
    <td>role</td>
    <td>VARCHAR(20)</td>
    <td>角色：MEMBER 或 ADMIN。</td>
  </tr>
  <tr>
    <td>created_at</td>
    <td>TIMESTAMP WITH TIME ZONE</td>
    <td>註冊時間。</td>
  </tr>
  <tr>
    <td>is_active</td>
    <td>BOOLEAN</td>
    <td>會員是否啟用／停用帳號。</td>
  </tr>

  <!-- CATEGORIES -->
  <tr>
    <td rowspan="3"><strong>categories</strong> (書籍類型)</td>
    <td>category_id</td>
    <td>SERIAL (PK)</td>
    <td>主鍵，自動遞增。</td>
  </tr>
  <tr>
    <td>name_zh</td>
    <td>VARCHAR(50)</td>
    <td>分類名稱 (中文，例如：文法、單字、會話)，UNIQUE。</td>
  </tr>
  <tr>
    <td>slug</td>
    <td>VARCHAR(50)</td>
    <td>網址用標籤 (如 grammar, vocab, reading)。</td>
  </tr>

  <!-- BOOKS -->
  <tr>
    <td rowspan="12"><strong>books</strong> (書籍資訊)</td>
    <td>book_id</td>
    <td>SERIAL (PK)</td>
    <td>主鍵，自動遞增。</td>
  </tr>
  <tr>
    <td>title</td>
    <td>VARCHAR(255)</td>
    <td>書籍名稱。</td>
  </tr>
  <tr>
    <td>author</td>
    <td>VARCHAR(100)</td>
    <td>作者。</td>
  </tr>
  <tr>
    <td>isbn</td>
    <td>VARCHAR(20)</td>
    <td>國際標準書號，UNIQUE。</td>
  </tr>
  <tr>
    <td>price</td>
    <td>NUMERIC(10, 2)</td>
    <td>價格。</td>
  </tr>
  <tr>
    <td>stock</td>
    <td>INTEGER</td>
    <td>庫存量。</td>
  </tr>
  <tr>
    <td>description</td>
    <td>TEXT</td>
    <td>書籍簡介。</td>
  </tr>
  <tr>
    <td>category_id</td>
    <td>INTEGER (FK)</td>
    <td>外鍵，連結 categories.category_id。</td>
  </tr>
  <tr>
    <td>lang</td>
    <td>VARCHAR(20)</td>
    <td>學習語言分類，例如：english, japanese, french。</td>
  </tr>
  <tr>
    <td>image_url</td>
    <td>TEXT</td>
    <td>封面圖片網址 (Supabase Storage)。</td>
  </tr>
  <tr>
    <td>is_onsale</td>
    <td>BOOLEAN</td>
    <td>上架(TRUE) / 下架(FALSE)。</td>
  </tr>
  <tr>
    <td>published_date</td>
    <td>DATE</td>
    <td>出版日期。</td>
  </tr>

  </tbody>
</table>
<hr>
<h2 id="section3">三、 前台功能 (Frontend Features)</h2>

<table>
  <thead>
  <tr>
    <th>功能模組</th>
    <th>功能細項</th>
    <th>實作細節與來源依據</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td><strong>會員功能</strong></td>
    <td>註冊、登入、修改、刪除</td>
    <td>登入透過 Supabase Auth 處理，JWT 放置在 Header 中供 Spring Boot 驗證。</td>
  </tr>
  <tr>
    <td rowspan="2"><strong>書籍查詢</strong></td>
    <td>依關鍵字查詢</td>
    <td>透過 Figma 原型中上方的搜尋欄位實現。</td>
  </tr>
  <tr>
    <td><span class="highlight">按照書本分類查詢</span></td>
    <td>利用動態內容切換技術，透過語言按鈕 (English, 日本語, Français, Deutsch, Español 等) 篩選。依賴 <code>books</code> 表的 <code>lang</code> 欄位。</td>
  </tr>
  <tr>
    <td rowspan="2"><strong>購物與結帳</strong></td>
    <td>購物車</td>
    <td>使用 <code>cart_items</code> 表格；Figma 原型展示了商品清單與小計。</td>
  </tr>
  <tr>
    <td>結帳流程</td>
    <td>分為 1. 資訊 (姓名、地址)、2. 運送、3. 訂單 三步驟。付款方式支援信用卡或貨到付款。</td>
  </tr>
  </tbody>
</table>

<hr>

<h2 id="section4">四、 後台管理功能 (Backend Admin Features)</h2>
<p>後台介面設計已包含「書本」、「訂單」、「會員」導航模組，所有操作需經 Spring Security + JWT Filter 驗證。</p>

<table>
  <thead>
  <tr>
    <th>模組</th>
    <th>功能名稱</th>
    <th>具體描述 (依據來源與規劃)</th>
    <th>來源依據</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td rowspan="4"><strong>書籍管理</strong></td>
    <td>書籍列表瀏覽與狀態監控</td>
    <td>顯示書名、價格、以及書籍的**狀態** (例如：「已上架」)。</td>
    <td>Figma 原型「後台書本管理」</td>
  </tr>
  <tr>
    <td>新增書籍 (Create)</td>
    <td>提供表單，允許管理員填入書名、價格、語言、描述等資料。</td>
    <td>Figma 原型「新增書本」</td>
  </tr>
  <tr>
    <td>修改書籍資訊 (Update)</td>
    <td>允許管理員編輯現有書籍的詳細資料。</td>
    <td>Figma 原型「後台書本管理」</td>
  </tr>
  <tr>
    <td><span class="highlight">**上架與下架控制**</span></td>
    <td>透過修改書籍的 <span class="highlight"><code>status</code></span> 欄位來控制商品在前台的顯示與否 [Figma原型展示「狀態」]。</td>
    <td>專案核心需求 (管理書籍含上架下架) [user query]</td>
  </tr>
  <tr>
    <td rowspan="2"><strong>訂單管理</strong></td>
    <td>訂單清單瀏覽</td>
    <td>檢視所有顧客的歷史訂單紀錄，追蹤訂單狀態。</td>
    <td>Figma 原型側邊導航「訂單」</td>
  </tr>
  <tr>
    <td>訂單狀態更新</td>
    <td>管理員手動更新訂單處理進度 (例如：已出貨)，支持電商管理流程。</td>
    <td>Figma 原型側邊導航「訂單」</td>
  </tr>
  <tr>
    <td rowspan="2"><strong>會員管理</strong></td>
    <td>會員清單瀏覽</td>
    <td>檢視所有由 Supabase Auth 註冊的會員基本資料。</td>
    <td>Figma 原型側邊導航「會員」</td>
  </tr>
  <tr>
    <td>會員資訊查詢</td>
    <td>允許管理員針對特定用戶進行查詢。</td>
    <td>會員管理邏輯需求</td>
  </tr>
  </tbody>
</table>
<hr>

<h2 id="section5">五、 帳號與權限架構（Role-Based Access Control, RBAC）</h2>

<p>
  本專案採用 <strong>RBAC 角色權限模型</strong>，將使用者區分為兩類：
</p>

<table>
  <thead>
  <tr>
    <th>角色 (Role)</th>
    <th>來源</th>
    <th>能做的事</th>
    <th>不能做的事</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td><strong>MEMBER</strong>（一般會員）</td>
    <td>使用「會員註冊」頁面註冊</td>
    <td>
      <ul>
        <li>註冊 / 登入</li>
        <li>搜尋書籍</li>
        <li>加入購物車 / 結帳</li>
        <li>更新個人資料</li>
      </ul>
    </td>
    <td>
      <ul>
        <li>不能進入後台</li>
        <li>不能新增 / 修改 / 刪除書籍</li>
        <li>不能查看訂單總覽或管理會員</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><strong>ADMIN</strong>（管理員）</td>
    <td>
      <strong>不從前台註冊獲得</strong><br>
      由開發者以以下方式建立：
      <ul>
        <li>資料庫 SQL 手動建立</li>
        <li>Spring Boot 專案啟動時自動建立</li>
        <li>Supabase Dashboard 新增後再改 role</li>
      </ul>
    </td>
    <td>
      <ul>
        <li>登入後進入後台管理系統</li>
        <li>新增 / 修改 / 下架書籍</li>
        <li>查看與更新訂單</li>
        <li>查看會員清單</li>
      </ul>
    </td>
    <td>不能透過前台註冊（安全性）</td>
  </tr>
  </tbody>
</table>

<p>
  📌 <strong>重點：</strong>管理員需透過登入流程取得 JWT，但不能透過註冊流程取得「ADMIN」。
</p>

<hr>

<h2 id="section6">六、 JWT 身分驗證流程（後端驗證方式）</h2>

<p>本專案以 <strong>Spring Boot 3 + JWT</strong> 作為登入與權限控制核心機制。</p>

<h3>🔐 JWT 流程圖（精簡版）</h3>

<table>
  <tbody>
  <tr>
    <td>
      <strong>1. 使用者登入</strong><br>
      使用 email + 密碼 → 送到後端
    </td>
    <td>➡</td>
    <td>
      <strong>2. 後端比對密碼</strong><br>
      驗證 Bcrypt 是否正確
    </td>
    <td>➡</td>
    <td>
      <strong>3. 後端產生 JWT</strong><br>
      Token 內包含角色資訊：<br>
      <code>{"sub": email, "role": "ADMIN"}</code>
    </td>
  </tr>
  <tr>
    <td colspan="5" style="text-align:center;">⬇ 使用者攜帶 JWT 掛在 Authorization Header</td>
  </tr>
  <tr>
    <td>
      <strong>4. 前端呼叫 API</strong><br>
      Header: <code>Authorization: Bearer xxx</code>
    </td>
    <td>➡</td>
    <td>
      <strong>5. JWT Filter 驗證 Token</strong>
    </td>
    <td>➡</td>
    <td>
      <strong>6. Spring Security 檢查角色</strong><br>
      <ul>
        <li>ADMIN → 可以進後台 API</li>
        <li>MEMBER → 只能進前台 API</li>
      </ul>
    </td>
  </tr>
  </tbody>
</table>

<p>
  ✔ 這套流程能確保：<br>
  <strong>一般會員無法偽造成管理員 → 安全可靠。</strong>
</p>

<hr>

<h2 id="section7">七、 管理員帳號的建立方式</h2>

<h3>方法 A：直接在 PostgreSQL 手動建立（推薦）</h3>

<pre>
INSERT INTO users (username, email, password_hash, role, is_active)
VALUES ('admin', 'admin@test.com',
        '$2a$10$XXXXXX',  -- bcrypt 加密後密碼
        'ADMIN', TRUE);
</pre>

<h3>方法 B：Spring Boot 專案啟動時自動建立</h3>

<pre>
@Bean
CommandLineRunner initAdmin(UserRepository repo, PasswordEncoder encoder) {
    return args -> {
        if (!repo.existsByEmail("admin@test.com")) {
            User admin = new User();
            admin.setUsername("admin");
            admin.setEmail("admin@test.com");
            admin.setPasswordHash(encoder.encode("admin123"));
            admin.setRole("ADMIN");
            repo.save(admin);
        }
    };
}
</pre>

<h3>方法 C：Supabase Dashboard 手動新增</h3>

<ol>
  <li>Supabase → Authentication → Add User</li>
  <li>新增 email / 密碼</li>
  <li>進入 SQL Editor 執行：
    <pre>
UPDATE users SET role='ADMIN'
WHERE email='admin@test.com';
  </pre></li>
</ol>

<p>✔ 任何方法都比讓管理員透過前台註冊安全得多。</p>
<hr>
<h2 id="section8">八、 Figma 設計：註冊與登入頁（Wireframe）</h2>

<p>
  前端採用 Figma 製作 Wireframe。登入與註冊頁是所有會員流程的起點，因此設計需清楚、簡潔、可快速完成輸入。
</p>

<h3>1. 會員登入頁（Login Wireframe）</h3>

<ul>
  <li>Email 輸入框</li>
  <li>密碼輸入框（隱藏顯示切換）</li>
  <li>登入按鈕</li>
  <li>導向「註冊帳號」的連結</li>
</ul>

<p><strong>流程：</strong></p>
<ol>
  <li>使用者輸入 Email + 密碼</li>
  <li>按登入後 → 呼叫後端 /login</li>
  <li>成功 → 從後端取得 JWT + 角色（role: MEMBER/ADMIN）</li>
  <li>前端依據角色導向不同頁面</li>
</ol>

<h3>2. 會員註冊頁（Register Wireframe）</h3>

<ul>
  <li>使用者名稱（username）</li>
  <li>Email</li>
  <li>密碼</li>
  <li>確認密碼</li>
  <li>註冊按鈕</li>
  <li>導向登入的連結</li>
</ul>

<p><strong>流程：</strong></p>
<ol>
  <li>使用者送出註冊資料</li>
  <li>後端建立新帳戶，<strong>強制設為 MEMBER</strong></li>
  <li>註冊成功 → 導向登入頁</li>
</ol>

<p>
  ✔ Figma 中可以用 <strong>Frame + Auto Layout</strong> 快速創建以上 Wireframe。
  ✔ 所有欄位建議搭配 placeholder（例如：Enter your email）。
</p>

<h3>【後端自動處理的欄位說明（不需進入 Figma 設計）】</h3>
<p>
  在本專案中，<strong>部分欄位由後端自動填入，不需要在 Figma 的註冊頁面中呈現或輸入。</strong>
  這些欄位在會員註冊時後端會自動設定：
</p>

<ul>
  <li><strong>role</strong>（預設：<code>MEMBER</code>）
    所有使用者透過前台註冊時，後端會強制把角色設為 MEMBER。<br>
    管理員帳號需由開發者在資料庫人工建立，或透過後台專用建立接口。
  </li>

  <li><strong>is_active</strong>（預設：<code>TRUE</code>）
    代表帳號啟用狀態，註冊時後端會自動設定為 TRUE。
    只有後台管理員可變更此值（例如停用可疑帳號）。
  </li>

  <li><strong>created_at</strong>（由資料庫 <code>NOW()</code> 自動產生）
    使用 PostgreSQL 的自動時間戳功能，不需要登入或註冊頁面輸入。
  </li>
</ul>

<p>
  因此，在 Figma 的註冊畫面中，使用者只需要看到與輸入：
</p>

<ul>
  <li>username（顯示名稱）</li>
  <li>email</li>
  <li>password + confirm password</li>
</ul>

<p>其他欄位完全由後端與資料庫自動處理，確保安全性與一致性。</p>

<hr>

<h2 id="section9">九、Figma AI 原型與資料同步說明</h2>

<p>
  前端畫面部分透過 <strong>Figma AI</strong> 生成高擬真網頁畫面，包括會員登入/註冊、書籍瀏覽、購物車與結帳等功能。
</p>

<p><strong>注意事項：</strong></p>
<ul>
  <li>Figma 原型中的資料為 <strong>死資料 / 模擬資料</strong>，不會實際存入資料庫。</li>
  <li>我在錄影或 Figma 原型中操作的「加入購物車」或「送出訂單」效果，僅是視覺互動模擬，並不會影響後台資料。</li>
  <li>後台管理介面顯示的是 <strong>真實資料庫</strong> (Supabase PostgreSQL) 的內容，因此我不會在後台看到原型中新增的假資料。</li>
  <li>前端真實功能需要程式碼串接後端 API 才能讓資料同步到後台，例如：
    <ul>
      <li>會員操作 → 呼叫 /api/login 或 /api/register</li>
      <li>購物車 / 訂單 → 呼叫 /api/cart、/api/order</li>
    </ul>
  </li>
  <li>在專案展示或報告中，可將 Figma 錄影作為「功能演示」使用，但需註明資料為模擬，避免混淆。</li>
</ul>

<p>
  總結：Figma AI 原型提供了高擬真視覺效果與操作流程，但資料不會自動寫入後端。真實資料同步仍需前端程式與後端 API 配合。
</p>
<hr>
<h2 id="section10">十、Figma 原型示範影片說明</h2>

<p>
  為了展示會員註冊、登入、書籍瀏覽、購物車與結帳的操作流程，本專案將 Figma AI 生成的高擬真網頁畫面錄製成影片，上傳至 YouTube，並透過 <code>&lt;iframe&gt;</code> 嵌入到本 HTML 頁面。
</p>

<p><strong>注意事項：</strong></p>
<ul>
  <li>影片中操作的資料均為 <strong>模擬資料 / 死資料</strong>，不會實際寫入後端資料庫。</li>
  <li>透過影片示範的購物車新增、送出訂單等互動效果，僅作為操作流程視覺演示。</li>
  <li>後台管理介面顯示的資料仍是實際資料庫的內容，因此影片中新增的假資料不會出現在後台。</li>
  <li>影片主要用途是展示操作流程、UI 介面與使用者互動，方便專案展示或報告使用。</li>
</ul>

<p><strong>嵌入影片範例：</strong></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/uRSejsB72CA?si=SYSHCu-Y6KwDqU1A" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<hr>
<h2 id="section11">十一、 Spring Boot：註冊與登入 API 程式碼</h2>

<p>為了安全，後端強制所有註冊而來的帳號皆為 MEMBER。</p>

<h3>1. 註冊 API（Register）</h3>

<pre>
@PostMapping("/register")
public ResponseEntity<?> register(@RequestBody RegisterRequest req) {

    if (userRepo.existsByEmail(req.getEmail())) {
        return ResponseEntity.badRequest().body("Email 已存在");
    }

    User user = new User();
    user.setUsername(req.getUsername());
    user.setEmail(req.getEmail());
    user.setPasswordHash(encoder.encode(req.getPassword()));

    // 強制所有前台註冊者角色為 MEMBER
    user.setRole("MEMBER");

    userRepo.save(user);

    return ResponseEntity.ok("註冊成功");
}
</pre>

<h3>2. 登入 API（Login）</h3>

<pre>
@PostMapping("/login")
public ResponseEntity<?> login(@RequestBody LoginRequest req) {

    User user = userRepo.findByEmail(req.getEmail())
            .orElseThrow(() -> new RuntimeException("帳號不存在"));

    if (!encoder.matches(req.getPassword(), user.getPasswordHash())) {
        return ResponseEntity.badRequest().body("密碼錯誤");
    }

    String token = jwtService.generateToken(user);

    return ResponseEntity.ok(new LoginResponse(token, user.getRole()));
}
</pre>

<h3>3. JWT 內容示例</h3>

<pre>
{
  "sub": "admin@test.com",
  "role": "ADMIN",
  "exp": 1712345678
}
</pre>

<p>✔ JWT 內包含使用者角色，可用於前端判斷導向頁面。</p>

<hr>

<h2 id="section12">十二、 Vue 前端：登入後依角色導向</h2>

<p>前端會接收 login API 回傳的 role。</p>

<h3>登入方法：</h3>

<pre>
axios.post('/login', { email, password })
  .then(res => {
    const token = res.data.token;
    const role = res.data.role;

    localStorage.setItem('token', token);
    localStorage.setItem('role', role);

    if (role === "ADMIN") {
        router.push('/admin');
    } else {
        router.push('/');
    }
  });
</pre>

<h3>前端路由保護（middleware）</h3>

<pre>
router.beforeEach((to, from, next) => {
  const role = localStorage.getItem('role');
  const token = localStorage.getItem('token');

  if (to.meta.requiresAdmin) {
    if (token && role === "ADMIN") next();
    else next('/login');
  } else {
    next();
  }
});
</pre>

<p>✔ 能確保一般會員無法直接進入後台 URL。</p>

<hr>

<h2 id="section13">十三、 Spring Security：後台 API 權限驗證</h2>

<p>後台 API 例如：</p>

<ul>
  <li>新增書籍：POST /admin/books</li>
  <li>修改書籍：PUT /admin/books/{id}</li>
  <li>查看全部訂單：GET /admin/orders</li>
</ul>

<h3>Security 配置：</h3>

<pre>
http
  .authorizeHttpRequests(auth -> auth
      .requestMatchers("/admin/**").hasRole("ADMIN")
      .requestMatchers("/user/**").hasAnyRole("MEMBER", "ADMIN")
      .requestMatchers("/public/**", "/login", "/register").permitAll()
      .anyRequest().authenticated()
  )
  .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class);
</pre>

<p>
  ✔ 只要 JWT 中角色不是 ADMIN，就無法進入 <code>/admin/**</code> API。
  ✔ 這是後端最重要的安全保障。
</p>

<hr>

<h2 id="section14">十四、 本專案的權限安全結論</h2>

<ul>
  <li><strong>管理員不可用會員註冊方式產生 → 必須人工建立</strong></li>
  <li>登入後依角色產生不同權限</li>
  <li>前端依據 role 導向不同介面</li>
  <li>後端以 JWT + Spring Security 作強制驗證</li>
</ul>

<p>
  🔒 <strong>確保網站前台與後台完全分離、安全、可靠。</strong>
</p>

</body>
</html>